(function() {
  var lastReport = null;

  if (!window.Logster) {
    window.Logster = {
      enabled: true
    };
  }

  window.Logster.reportError = function(options) {
    // never bother reporting more than once a minute
    if (lastReport && new Date() - lastReport < 1000 * 60) {
      return;
    }

    if (!Logster.enabled) {
      return;
    }

    lastReport = new Date();

    var err = {
      message: options.message,
      url: options.url,
      line: options.line,
      column: options.column,
      window_location: options.windowLocation,
      stacktrace: options.stacktrace
    };

    $.ajax("<%= Logster.config.subdirectory %>" + "/report_js_error", {
      data: err,
      type: "POST",
      cache: false
    });

  }

  window.onerror = function(message, url, line, column, errorObj) {
    window.Logster.reportError({
      message: message,
      url: url,
      line: line,
      column: column,
      windowLocation: window.location && (window.location + ""),
      stacktrace: errorObj && errorObj.stack
    });
  };
})();
